import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton

API_TOKEN = '????????????????????'
bot = telebot.TeleBot(API_TOKEN)

user_data = {}

# –í–æ–ø—Ä–æ—Å—ã –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã
questions = [
    {
        'text': '1. –ö–∞–∫–∞—è —É –≤–∞—Å —Ñ–æ—Ä–º–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?',
        'options': ['–§–∏–∑–ª–∏—Ü–æ', '–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π', '–ò–ü', '–û–û–û']
    },
    {
        'text': '2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:',
        'options': [
            '–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏', '–†–µ–ø–µ—Ç–∏—Ç–æ—Ä—Å—Ç–≤–æ', '–í–µ–±-–¥–∏–∑–∞–π–Ω',
            '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', '–§–æ—Ç–æ/–≤–∏–¥–µ–æ —Å—ä—ë–º–∫–∞', '–î–æ—Å—Ç–∞–≤–∫–∞',
            '–¢–æ—Ä–≥–æ–≤–ª—è', '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '–ê—Ä–µ–Ω–¥–∞',
            '–°–¥–∞—á–∞ –∂–∏–ª—å—è', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏', '–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ',
            '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û', '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥', '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
        ]
    },
    {
        'text': '3. –ö–∞–∫–æ–π —É –≤–∞—Å –ø—Ä–∏–º–µ—Ä–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ –≥–æ–¥?',
        'options': ['–î–æ 2.4 –º–ª–Ω', '–î–æ 60 –º–ª–Ω', '–î–æ 200 –º–ª–Ω', '–ë–æ–ª–µ–µ 200 –º–ª–Ω']
    },
    {
        'text': '4. –ï—Å—Ç—å –ª–∏ —É –≤–∞—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏(–æ—Ñ–∏—Ü–∞–ª—å–Ω–æ)?',
        'options': ['–†–∞–±–æ—Ç–∞—é –æ–¥–∏–Ω', '1‚Äì5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', '–ë–æ–ª–µ–µ 5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤']
    },
    {
        'text': '5. –° –∫–µ–º –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?',
        'options': ['–° —Ñ–∏–∑–ª–∏—Ü–∞–º–∏', '–° —é—Ä–ª–∏—Ü–∞–º–∏', '–ò —Å —Ç–µ–º–∏, –∏ —Å –¥—Ä—É–≥–∏–º–∏']
    },
    {
        'text': '6. –ü—Ä–æ—Å—è—Ç –ª–∏ –≤–∞—Å –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –ù–î–°?',
        'options': ['–î–∞', '–ù–µ—Ç']
    },
    {
        'text': '7. –ö–∞–∫–∏–µ —É –≤–∞—Å —Ä–∞—Å—Ö–æ–¥—ã?',
        'options': ['–ü–æ—á—Ç–∏ –Ω–µ—Ç', '–°—Ä–µ–¥–Ω–∏–µ', '–í—ã—Å–æ–∫–∏–µ']
    },
    {
        'text': '8. –í –∫–∞–∫–æ–º —Ä–µ–≥–∏–æ–Ω–µ –≤—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã?',
        'options': ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω', '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–î—Ä—É–≥–æ–π —Ä–µ–≥–∏–æ–Ω']
    }
]

# –°—Ç–∞—Ä—Ç
@bot.message_handler(commands=['start'])
def start(message):
    user_data[message.chat.id] = {'step': 0, 'answers': []}
    ask_question(message.chat.id)

def ask_question(chat_id):
    step = user_data[chat_id]['step']
    if step < len(questions):
        q = questions[step]
        markup = InlineKeyboardMarkup()
        for opt in q['options']:
            markup.add(InlineKeyboardButton(opt, callback_data=opt))
        bot.send_message(chat_id, q['text'], reply_markup=markup)
    else:
        show_result(chat_id)

def show_result(chat_id):
    answers = user_data[chat_id]['answers']

    form = answers[0]
    activity = answers[1]
    income = answers[2]
    employees = answers[3]
    clients = answers[4]
    asks_nds = answers[5]
    expenses = answers[6]
    region = answers[7]

    result = ''

    if form == '–§–∏–∑–ª–∏—Ü–æ':
        if income == '–î–æ 2.4 –º–ª–Ω' and employees == '–†–∞–±–æ—Ç–∞—é –æ–¥–∏–Ω' and activity in ['–†–µ–ø–µ—Ç–∏—Ç–æ—Ä—Å—Ç–≤–æ', '–§–æ—Ç–æ/–≤–∏–¥–µ–æ —Å—ä—ë–º–∫–∞', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏']:
            result = ('‚úÖ –í–∞–º –ø–æ–¥–æ–π–¥—ë—Ç —Ä–µ–∂–∏–º: –ù–ü–î (–Ω–∞–ª–æ–≥ –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥)\n'
                      '‚ûï –ü–ª—é—Å—ã: –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, 4‚Äì6% –Ω–∞–ª–æ–≥, –Ω–µ –Ω—É–∂–Ω—ã –æ—Ç—á—ë—Ç—ã\n'
                      '‚ûñ –ú–∏–Ω—É—Å—ã: –Ω–µ–ª—å–∑—è –Ω–∞–Ω–∏–º–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞\n'
                      'üìå –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–ú–æ–π –Ω–∞–ª–æ–≥" –¥–ª—è —É—á—ë—Ç–∞')
        else:
            result = '‚ö†Ô∏è –í–∞–º –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ò–ü –∏–ª–∏ —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–π –¥–ª—è –ª–µ–≥–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.'

    elif form == '–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π':
        if income == '–î–æ 2.4 –º–ª–Ω' and employees == '–†–∞–±–æ—Ç–∞—é –æ–¥–∏–Ω':
            result = ('‚úÖ –í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ –ù–ü–î.\n'
                      '‚ûï –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–µ—Ç –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏\n'
                      '‚ûñ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤–∏–¥–∞–º –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n'
                      'üìå –°–ª–µ–¥–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –≤—ã–π—Ç–∏ –∑–∞ –ª–∏–º–∏—Ç 2.4 –º–ª–Ω —Ä—É–±.')
        else:
            result = '‚ö†Ô∏è –í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç—ã —Å–∞–º–æ–∑–∞–Ω—è—Ç–æ—Å—Ç–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ò–ü —Å –£–°–ù.'

    elif form == '–ò–ü':
        if income in ['–î–æ 2.4 –º–ª–Ω', '–î–æ 60 –º–ª–Ω', '–î–æ 200 –º–ª–Ω']:
            if expenses == '–í—ã—Å–æ–∫–∏–µ':
                rate = '15%'
                mode = '–£–°–ù 15% (–¥–æ—Ö–æ–¥—ã –º–∏–Ω—É—Å —Ä–∞—Å—Ö–æ–¥—ã)'
            else:
                rate = '6%'
                mode = '–£–°–ù 6% (–¥–æ—Ö–æ–¥—ã)'
            region_note = f'üìç –í —Ä–µ–≥–∏–æ–Ω–µ "{region}" –º–æ–≥—É—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–Ω–∏–∂–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –£–°–ù, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ –§–ù–°.'
            result = (f'‚úÖ –í–∞–º –ø–æ–¥–æ–π–¥—ë—Ç —Ä–µ–∂–∏–º: {mode}\n'
                      f'‚ûï –ü—Ä–æ—Å—Ç–æ—Ç–∞ —É—á—ë—Ç–∞, –ø–æ–Ω–∏–∂–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤\n'
                      f'‚ûñ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–¥–∞—á–∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –¥–æ—Ö–æ–¥—É –∏ —á–∏—Å–ª—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤\n'
                      f'{region_note}\nüìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω-–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ú–æ—ë –¥–µ–ª–æ, –ö–æ–Ω—Ç—É—Ä).')
            if activity in ['–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏', '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', '–§–æ—Ç–æ/–≤–∏–¥–µ–æ —Å—ä—ë–º–∫–∞'] and employees == '–†–∞–±–æ—Ç–∞—é –æ–¥–∏–Ω':
                result += '\nüìå –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ü–°–ù (–ø–∞—Ç–µ–Ω—Ç), –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ.'
        else:
            result = '‚ö†Ô∏è –í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –£–°–ù. –í–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –û–°–ù–û.'

    elif form == '–û–û–û':
        if asks_nds == '–î–∞' or clients in ['–° —é—Ä–ª–∏—Ü–∞–º–∏', '–ò —Å —Ç–µ–º–∏, –∏ —Å –¥—Ä—É–≥–∏–º–∏']:
            result = ('‚úÖ –í–∞–º –ø–æ–¥–æ–π–¥—ë—Ç —Ä–µ–∂–∏–º: –û–°–ù–û (–æ–±—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è —Å –ù–î–°)\n'
                      '‚ûï –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—Ä—É–ø–Ω—ã–º–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏, –≤—ã—á–µ—Ç—ã –ø–æ –ù–î–°\n'
                      '‚ûñ –°–ª–æ–∂–Ω–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∏–π –Ω–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏–±—ã–ª—å\n'
                      'üìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–µ—Å—Ç–∏ —É—á—ë—Ç —á–µ—Ä–µ–∑ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ –∏–ª–∏ —Å–µ—Ä–≤–∏—Å —Ç–∏–ø–∞ 1–°')
        elif income in ['–î–æ 200 –º–ª–Ω']:
            if expenses == '–í—ã—Å–æ–∫–∏–µ':
                mode = '–£–°–ù 15%'
            else:
                mode = '–£–°–ù 6%'
            result = (f'‚úÖ –í–∞–º –ø–æ–¥–æ–π–¥—ë—Ç —Ä–µ–∂–∏–º: {mode} –¥–ª—è –û–û–û\n'
                      '‚ûï –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —É—á—ë—Ç\n'
                      '‚ûñ –ù–µ—Ç –ù–î–° ‚Äî –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–æ–π—Ç–∏ –¥–ª—è B2B\nüìå –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.')
        else:
            result = '‚ö†Ô∏è –û–û–û —Å –±–æ–ª—å—à–æ–π –≤—ã—Ä—É—á–∫–æ–π –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –û–°–ù–û.'

    else:
        result = '‚ùì –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —É –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.'

    bot.send_message(chat_id, result)

    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton('üîÅ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ', callback_data='restart'))
    bot.send_message(chat_id, '–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å –µ—â—ë —Ä–∞–∑?', reply_markup=markup)
    user_data.pop(chat_id, None)

@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    chat_id = call.message.chat.id

    if call.data == 'restart':
        user_data[chat_id] = {'step': 0, 'answers': []}
        ask_question(chat_id)
        return

    step = user_data[chat_id]['step']
    user_data[chat_id]['answers'].append(call.data)
    user_data[chat_id]['step'] += 1
    ask_question(chat_id)

bot.polling(none_stop=True)
